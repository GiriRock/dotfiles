#!/usr/bin/env bash
set -euo pipefail

# Where your dotfiles live (override if needed)
DOTFILES_DIR="${DOTFILES_DIR:-$HOME/dotfiles}"
TS=$(date +%Y%m%d%H%M%S)

# list of "src:dest" mappings
links=(
  "$DOTFILES_DIR/.config/nvim:$HOME/.config/nvim"
  "$DOTFILES_DIR/.config/wezterm:$HOME/.config/wezterm"
  "$DOTFILES_DIR/.zshrc:$HOME/.zshrc"
  "$DOTFILES_DIR/.gitconfig:$HOME/.gitconfig"
)

echo "â–¶ Linking dotfiles from $DOTFILES_DIR â€¦"

for mapping in "${links[@]}"; do
  IFS=':' read -r src dest <<< "$mapping"

  # 1) Skip if source doesn't exist
  if [ ! -e "$src" ]; then
    echo "  âš ï¸  Source missing: $src â€” skipping."
    continue
  fi

  # 2) Backup any real file/dir at $dest
  if [ -e "$dest" ] && [ ! -L "$dest" ]; then
    mv "$dest" "${dest}.backup.$TS"
    echo "  ðŸ”„  Backed up $dest â†’ ${dest}.backup.$TS"
  fi

  # 3) Remove old symlink so ln -s will succeed
  if [ -L "$dest" ]; then
    rm "$dest"
    echo "  ðŸ—‘ï¸  Removed old symlink $dest"
  fi

  # 4) Ensure parent dir exists
  mkdir -p "$(dirname "$dest")"

  # 5) Create the symlink
  ln -s "$src" "$dest"
  echo "  ðŸ”—  ln -s $src $dest"
done

echo "âœ… All done!"

